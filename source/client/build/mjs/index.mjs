var K4=Object.defineProperty;var H1=(I,$)=>{for(var Q in $)K4(I,Q,{get:$[Q],enumerable:!0,configurable:!0,set:(Z)=>$[Q]=()=>Z})};var H=Object.create(null);H.open="0";H.close="1";H.ping="2";H.pong="3";H.message="4";H.upgrade="5";H.noop="6";var R=Object.create(null);Object.keys(H).forEach((I)=>{R[H[I]]=I});var S={type:"error",data:"parser error"};var D1=typeof Blob==="function"||typeof Blob!=="undefined"&&Object.prototype.toString.call(Blob)==="[object BlobConstructor]",L1=typeof ArrayBuffer==="function",A1=(I)=>{return typeof ArrayBuffer.isView==="function"?ArrayBuffer.isView(I):I&&I.buffer instanceof ArrayBuffer},v=({type:I,data:$},Q,Z)=>{if(D1&&$ instanceof Blob)if(Q)return Z($);else return W1($,Z);else if(L1&&($ instanceof ArrayBuffer||A1($)))if(Q)return Z($);else return W1(new Blob([$]),Z);return Z(H[I]+($||""))},W1=(I,$)=>{let Q=new FileReader;return Q.onload=function(){let Z=Q.result.split(",")[1];$("b"+(Z||""))},Q.readAsDataURL(I)};function w1(I){if(I instanceof Uint8Array)return I;else if(I instanceof ArrayBuffer)return new Uint8Array(I);else return new Uint8Array(I.buffer,I.byteOffset,I.byteLength)}var e;function B1(I,$){if(D1&&I.data instanceof Blob)return I.data.arrayBuffer().then(w1).then($);else if(L1&&(I.data instanceof ArrayBuffer||A1(I.data)))return $(w1(I.data));v(I,!1,(Q)=>{if(!e)e=new TextEncoder;$(e.encode(Q))})}var E=typeof Uint8Array==="undefined"?[]:new Uint8Array(256);for(let I=0;I<64;I++)E["ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charCodeAt(I)]=I;var N1=(I)=>{let $=I.length*0.75,Q=I.length,Z,J=0,K,Y,M,z;if(I[I.length-1]==="="){if($--,I[I.length-2]==="=")$--}let C=new ArrayBuffer($),F=new Uint8Array(C);for(Z=0;Z<Q;Z+=4)K=E[I.charCodeAt(Z)],Y=E[I.charCodeAt(Z+1)],M=E[I.charCodeAt(Z+2)],z=E[I.charCodeAt(Z+3)],F[J++]=K<<2|Y>>4,F[J++]=(Y&15)<<4|M>>2,F[J++]=(M&3)<<6|z&63;return C};var Y4=typeof ArrayBuffer==="function",P=(I,$)=>{if(typeof I!=="string")return{type:"message",data:x1(I,$)};let Q=I.charAt(0);if(Q==="b")return{type:"message",data:O4(I.substring(1),$)};if(!R[Q])return S;return I.length>1?{type:R[Q],data:I.substring(1)}:{type:R[Q]}},O4=(I,$)=>{if(Y4){let Q=N1(I);return x1(Q,$)}else return{base64:!0,data:I}},x1=(I,$)=>{switch($){case"blob":if(I instanceof Blob)return I;else return new Blob([I]);case"arraybuffer":default:if(I instanceof ArrayBuffer)return I;else return I.buffer}};var q1=String.fromCharCode(30),_1=(I,$)=>{let Q=I.length,Z=new Array(Q),J=0;I.forEach((K,Y)=>{v(K,!1,(M)=>{if(Z[Y]=M,++J===Q)$(Z.join(q1))})})},m1=(I,$)=>{let Q=I.split(q1),Z=[];for(let J=0;J<Q.length;J++){let K=P(Q[J],$);if(Z.push(K),K.type==="error")break}return Z};function R1(){return new TransformStream({transform(I,$){B1(I,(Q)=>{let Z=Q.length,J;if(Z<126)J=new Uint8Array(1),new DataView(J.buffer).setUint8(0,Z);else if(Z<65536){J=new Uint8Array(3);let K=new DataView(J.buffer);K.setUint8(0,126),K.setUint16(1,Z)}else{J=new Uint8Array(9);let K=new DataView(J.buffer);K.setUint8(0,127),K.setBigUint64(1,BigInt(Z))}if(I.data&&typeof I.data!=="string")J[0]|=128;$.enqueue(J),$.enqueue(Q)})}})}var I1;function b(I){return I.reduce(($,Q)=>$+Q.length,0)}function n(I,$){if(I[0].length===$)return I.shift();let Q=new Uint8Array($),Z=0;for(let J=0;J<$;J++)if(Q[J]=I[0][Z++],Z===I[0].length)I.shift(),Z=0;if(I.length&&Z<I[0].length)I[0]=I[0].slice(Z);return Q}function S1(I,$){if(!I1)I1=new TextDecoder;let Q=[],Z=0,J=-1,K=!1;return new TransformStream({transform(Y,M){Q.push(Y);while(!0){if(Z===0){if(b(Q)<1)break;let z=n(Q,1);if(K=(z[0]&128)===128,J=z[0]&127,J<126)Z=3;else if(J===126)Z=1;else Z=2}else if(Z===1){if(b(Q)<2)break;let z=n(Q,2);J=new DataView(z.buffer,z.byteOffset,z.length).getUint16(0),Z=3}else if(Z===2){if(b(Q)<8)break;let z=n(Q,8),C=new DataView(z.buffer,z.byteOffset,z.length),F=C.getUint32(0);if(F>Math.pow(2,21)-1){M.enqueue(S);break}J=F*Math.pow(2,32)+C.getUint32(4),Z=3}else{if(b(Q)<J)break;let z=n(Q,J);M.enqueue(P(K?z:I1.decode(z),$)),Z=0}if(J===0||J>I){M.enqueue(S);break}}}})}var $1=4;function X(I){if(I)return X4(I)}function X4(I){for(var $ in X.prototype)I[$]=X.prototype[$];return I}X.prototype.on=X.prototype.addEventListener=function(I,$){return this._callbacks=this._callbacks||{},(this._callbacks["$"+I]=this._callbacks["$"+I]||[]).push($),this};X.prototype.once=function(I,$){function Q(){this.off(I,Q),$.apply(this,arguments)}return Q.fn=$,this.on(I,Q),this};X.prototype.off=X.prototype.removeListener=X.prototype.removeAllListeners=X.prototype.removeEventListener=function(I,$){if(this._callbacks=this._callbacks||{},arguments.length==0)return this._callbacks={},this;var Q=this._callbacks["$"+I];if(!Q)return this;if(arguments.length==1)return delete this._callbacks["$"+I],this;var Z;for(var J=0;J<Q.length;J++)if(Z=Q[J],Z===$||Z.fn===$){Q.splice(J,1);break}if(Q.length===0)delete this._callbacks["$"+I];return this};X.prototype.emit=function(I){this._callbacks=this._callbacks||{};var $=new Array(arguments.length-1),Q=this._callbacks["$"+I];for(var Z=1;Z<arguments.length;Z++)$[Z-1]=arguments[Z];if(Q){Q=Q.slice(0);for(var Z=0,J=Q.length;Z<J;++Z)Q[Z].apply(this,$)}return this};X.prototype.emitReserved=X.prototype.emit;X.prototype.listeners=function(I){return this._callbacks=this._callbacks||{},this._callbacks["$"+I]||[]};X.prototype.hasListeners=function(I){return!!this.listeners(I).length};var D=(()=>{if(typeof Promise==="function"&&typeof Promise.resolve==="function")return($)=>Promise.resolve().then($);else return($,Q)=>Q($,0)})(),U=(()=>{if(typeof self!=="undefined")return self;else if(typeof window!=="undefined")return window;else return Function("return this")()})(),v1="arraybuffer";function E1(){}function i(I,...$){return $.reduce((Q,Z)=>{if(I.hasOwnProperty(Z))Q[Z]=I[Z];return Q},{})}var z4=U.setTimeout,M4=U.clearTimeout;function L(I,$){if($.useNativeTimers)I.setTimeoutFn=z4.bind(U),I.clearTimeoutFn=M4.bind(U);else I.setTimeoutFn=U.setTimeout.bind(U),I.clearTimeoutFn=U.clearTimeout.bind(U)}var G4=1.33;function P1(I){if(typeof I==="string")return F4(I);return Math.ceil((I.byteLength||I.size)*G4)}function F4(I){let $=0,Q=0;for(let Z=0,J=I.length;Z<J;Z++)if($=I.charCodeAt(Z),$<128)Q+=1;else if($<2048)Q+=2;else if($<55296||$>=57344)Q+=3;else Z++,Q+=4;return Q}function d(){return Date.now().toString(36).substring(3)+Math.random().toString(36).substring(2,5)}function h1(I){let $="";for(let Q in I)if(I.hasOwnProperty(Q)){if($.length)$+="&";$+=encodeURIComponent(Q)+"="+encodeURIComponent(I[Q])}return $}function g1(I){let $={},Q=I.split("&");for(let Z=0,J=Q.length;Z<J;Z++){let K=Q[Z].split("=");$[decodeURIComponent(K[0])]=decodeURIComponent(K[1])}return $}class Q1 extends Error{constructor(I,$,Q){super(I);this.description=$,this.context=Q,this.type="TransportError"}}class B extends X{constructor(I){super();this.writable=!1,L(this,I),this.opts=I,this.query=I.query,this.socket=I.socket,this.supportsBinary=!I.forceBase64}onError(I,$,Q){return super.emitReserved("error",new Q1(I,$,Q)),this}open(){return this.readyState="opening",this.doOpen(),this}close(){if(this.readyState==="opening"||this.readyState==="open")this.doClose(),this.onClose();return this}send(I){if(this.readyState==="open")this.write(I)}onOpen(){this.readyState="open",this.writable=!0,super.emitReserved("open")}onData(I){let $=P(I,this.socket.binaryType);this.onPacket($)}onPacket(I){super.emitReserved("packet",I)}onClose(I){this.readyState="closed",super.emitReserved("close",I)}pause(I){}createUri(I,$={}){return I+"://"+this._hostname()+this._port()+this.opts.path+this._query($)}_hostname(){let I=this.opts.hostname;return I.indexOf(":")===-1?I:"["+I+"]"}_port(){if(this.opts.port&&(this.opts.secure&&Number(this.opts.port!==443)||!this.opts.secure&&Number(this.opts.port)!==80))return":"+this.opts.port;else return""}_query(I){let $=h1(I);return $.length?"?"+$:""}}class k extends B{constructor(){super(...arguments);this._polling=!1}get name(){return"polling"}doOpen(){this._poll()}pause(I){this.readyState="pausing";let $=()=>{this.readyState="paused",I()};if(this._polling||!this.writable){let Q=0;if(this._polling)Q++,this.once("pollComplete",function(){--Q||$()});if(!this.writable)Q++,this.once("drain",function(){--Q||$()})}else $()}_poll(){this._polling=!0,this.doPoll(),this.emitReserved("poll")}onData(I){let $=(Q)=>{if(this.readyState==="opening"&&Q.type==="open")this.onOpen();if(Q.type==="close")return this.onClose({description:"transport closed by the server"}),!1;this.onPacket(Q)};if(m1(I,this.socket.binaryType).forEach($),this.readyState!=="closed"){if(this._polling=!1,this.emitReserved("pollComplete"),this.readyState==="open")this._poll()}}doClose(){let I=()=>{this.write([{type:"close"}])};if(this.readyState==="open")I();else this.once("open",I)}write(I){this.writable=!1,_1(I,($)=>{this.doWrite($,()=>{this.writable=!0,this.emitReserved("drain")})})}uri(){let I=this.opts.secure?"https":"http",$=this.query||{};if(this.opts.timestampRequests!==!1)$[this.opts.timestampParam]=d();if(!this.supportsBinary&&!$.sid)$.b64=1;return this.createUri(I,$)}}var T1=!1;try{T1=typeof XMLHttpRequest!=="undefined"&&"withCredentials"in new XMLHttpRequest}catch(I){}var j1=T1;function U4(){}class y1 extends k{constructor(I){super(I);if(typeof location!=="undefined"){let $=location.protocol==="https:",Q=location.port;if(!Q)Q=$?"443":"80";this.xd=typeof location!=="undefined"&&I.hostname!==location.hostname||Q!==I.port}}doWrite(I,$){let Q=this.request({method:"POST",data:I});Q.on("success",$),Q.on("error",(Z,J)=>{this.onError("xhr post error",Z,J)})}doPoll(){let I=this.request();I.on("data",this.onData.bind(this)),I.on("error",($,Q)=>{this.onError("xhr poll error",$,Q)}),this.pollXhr=I}}class W extends X{constructor(I,$,Q){super();this.createRequest=I,L(this,Q),this._opts=Q,this._method=Q.method||"GET",this._uri=$,this._data=Q.data!==void 0?Q.data:null,this._create()}_create(){var I;let $=i(this._opts,"agent","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","autoUnref");$.xdomain=!!this._opts.xd;let Q=this._xhr=this.createRequest($);try{Q.open(this._method,this._uri,!0);try{if(this._opts.extraHeaders){Q.setDisableHeaderCheck&&Q.setDisableHeaderCheck(!0);for(let Z in this._opts.extraHeaders)if(this._opts.extraHeaders.hasOwnProperty(Z))Q.setRequestHeader(Z,this._opts.extraHeaders[Z])}}catch(Z){}if(this._method==="POST")try{Q.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch(Z){}try{Q.setRequestHeader("Accept","*/*")}catch(Z){}if((I=this._opts.cookieJar)===null||I===void 0||I.addCookies(Q),"withCredentials"in Q)Q.withCredentials=this._opts.withCredentials;if(this._opts.requestTimeout)Q.timeout=this._opts.requestTimeout;Q.onreadystatechange=()=>{var Z;if(Q.readyState===3)(Z=this._opts.cookieJar)===null||Z===void 0||Z.parseCookies(Q.getResponseHeader("set-cookie"));if(Q.readyState!==4)return;if(Q.status===200||Q.status===1223)this._onLoad();else this.setTimeoutFn(()=>{this._onError(typeof Q.status==="number"?Q.status:0)},0)},Q.send(this._data)}catch(Z){this.setTimeoutFn(()=>{this._onError(Z)},0);return}if(typeof document!=="undefined")this._index=W.requestsCount++,W.requests[this._index]=this}_onError(I){this.emitReserved("error",I,this._xhr),this._cleanup(!0)}_cleanup(I){if(typeof this._xhr==="undefined"||this._xhr===null)return;if(this._xhr.onreadystatechange=U4,I)try{this._xhr.abort()}catch($){}if(typeof document!=="undefined")delete W.requests[this._index];this._xhr=null}_onLoad(){let I=this._xhr.responseText;if(I!==null)this.emitReserved("data",I),this.emitReserved("success"),this._cleanup()}abort(){this._cleanup()}}W.requestsCount=0;W.requests={};if(typeof document!=="undefined"){if(typeof attachEvent==="function")attachEvent("onunload",f1);else if(typeof addEventListener==="function"){let I="onpagehide"in U?"pagehide":"unload";addEventListener(I,f1,!1)}}function f1(){for(let I in W.requests)if(W.requests.hasOwnProperty(I))W.requests[I].abort()}var V4=function(){let I=l1({xdomain:!1});return I&&I.responseType!==null}();class N extends y1{constructor(I){super(I);let $=I&&I.forceBase64;this.supportsBinary=V4&&!$}request(I={}){return Object.assign(I,{xd:this.xd},this.opts),new W(l1,this.uri(),I)}}function l1(I){let $=I.xdomain;try{if(typeof XMLHttpRequest!=="undefined"&&(!$||j1))return new XMLHttpRequest}catch(Q){}if(!$)try{return new U[["Active"].concat("Object").join("X")]("Microsoft.XMLHTTP")}catch(Q){}}var u1=typeof navigator!=="undefined"&&typeof navigator.product==="string"&&navigator.product.toLowerCase()==="reactnative";class b1 extends B{get name(){return"websocket"}doOpen(){let I=this.uri(),$=this.opts.protocols,Q=u1?{}:i(this.opts,"agent","perMessageDeflate","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","localAddress","protocolVersion","origin","maxPayload","family","checkServerIdentity");if(this.opts.extraHeaders)Q.headers=this.opts.extraHeaders;try{this.ws=this.createSocket(I,$,Q)}catch(Z){return this.emitReserved("error",Z)}this.ws.binaryType=this.socket.binaryType,this.addEventListeners()}addEventListeners(){this.ws.onopen=()=>{if(this.opts.autoUnref)this.ws._socket.unref();this.onOpen()},this.ws.onclose=(I)=>this.onClose({description:"websocket connection closed",context:I}),this.ws.onmessage=(I)=>this.onData(I.data),this.ws.onerror=(I)=>this.onError("websocket error",I)}write(I){this.writable=!1;for(let $=0;$<I.length;$++){let Q=I[$],Z=$===I.length-1;v(Q,this.supportsBinary,(J)=>{try{this.doWrite(Q,J)}catch(K){}if(Z)D(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){if(typeof this.ws!=="undefined")this.ws.onerror=()=>{},this.ws.close(),this.ws=null}uri(){let I=this.opts.secure?"wss":"ws",$=this.query||{};if(this.opts.timestampRequests)$[this.opts.timestampParam]=d();if(!this.supportsBinary)$.b64=1;return this.createUri(I,$)}}var Z1=U.WebSocket||U.MozWebSocket;class x extends b1{createSocket(I,$,Q){return!u1?$?new Z1(I,$):new Z1(I):new Z1(I,$,Q)}doWrite(I,$){this.ws.send($)}}class h extends B{get name(){return"webtransport"}doOpen(){try{this._transport=new WebTransport(this.createUri("https"),this.opts.transportOptions[this.name])}catch(I){return this.emitReserved("error",I)}this._transport.closed.then(()=>{this.onClose()}).catch((I)=>{this.onError("webtransport error",I)}),this._transport.ready.then(()=>{this._transport.createBidirectionalStream().then((I)=>{let $=S1(Number.MAX_SAFE_INTEGER,this.socket.binaryType),Q=I.readable.pipeThrough($).getReader(),Z=R1();Z.readable.pipeTo(I.writable),this._writer=Z.writable.getWriter();let J=()=>{Q.read().then(({done:Y,value:M})=>{if(Y)return;this.onPacket(M),J()}).catch((Y)=>{})};J();let K={type:"open"};if(this.query.sid)K.data=`{"sid":"${this.query.sid}"}`;this._writer.write(K).then(()=>this.onOpen())})})}write(I){this.writable=!1;for(let $=0;$<I.length;$++){let Q=I[$],Z=$===I.length-1;this._writer.write(Q).then(()=>{if(Z)D(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){var I;(I=this._transport)===null||I===void 0||I.close()}}var J1={websocket:x,webtransport:h,polling:N};var C4=/^(?:(?![^:@\/?#]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@\/?#]*)(?::([^:@\/?#]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,H4=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];function _(I){if(I.length>8000)throw"URI too long";let $=I,Q=I.indexOf("["),Z=I.indexOf("]");if(Q!=-1&&Z!=-1)I=I.substring(0,Q)+I.substring(Q,Z).replace(/:/g,";")+I.substring(Z,I.length);let J=C4.exec(I||""),K={},Y=14;while(Y--)K[H4[Y]]=J[Y]||"";if(Q!=-1&&Z!=-1)K.source=$,K.host=K.host.substring(1,K.host.length-1).replace(/;/g,":"),K.authority=K.authority.replace("[","").replace("]","").replace(/;/g,":"),K.ipv6uri=!0;return K.pathNames=W4(K,K.path),K.queryKey=w4(K,K.query),K}function W4(I,$){let Q=/\/{2,9}/g,Z=$.replace(Q,"/").split("/");if($.slice(0,1)=="/"||$.length===0)Z.splice(0,1);if($.slice(-1)=="/")Z.splice(Z.length-1,1);return Z}function w4(I,$){let Q={};return $.replace(/(?:^|&)([^&=]*)=?([^&]*)/g,function(Z,J,K){if(J)Q[J]=K}),Q}var K1=typeof addEventListener==="function"&&typeof removeEventListener==="function",c=[];if(K1)addEventListener("offline",()=>{c.forEach((I)=>I())},!1);class A extends X{constructor(I,$){super();if(this.binaryType=v1,this.writeBuffer=[],this._prevBufferLen=0,this._pingInterval=-1,this._pingTimeout=-1,this._maxPayload=-1,this._pingTimeoutTime=1/0,I&&typeof I==="object")$=I,I=null;if(I){let Q=_(I);if($.hostname=Q.host,$.secure=Q.protocol==="https"||Q.protocol==="wss",$.port=Q.port,Q.query)$.query=Q.query}else if($.host)$.hostname=_($.host).host;if(L(this,$),this.secure=$.secure!=null?$.secure:typeof location!=="undefined"&&location.protocol==="https:",$.hostname&&!$.port)$.port=this.secure?"443":"80";if(this.hostname=$.hostname||(typeof location!=="undefined"?location.hostname:"localhost"),this.port=$.port||(typeof location!=="undefined"&&location.port?location.port:this.secure?"443":"80"),this.transports=[],this._transportsByName={},$.transports.forEach((Q)=>{let Z=Q.prototype.name;this.transports.push(Z),this._transportsByName[Z]=Q}),this.opts=Object.assign({path:"/engine.io",agent:!1,withCredentials:!1,upgrade:!0,timestampParam:"t",rememberUpgrade:!1,addTrailingSlash:!0,rejectUnauthorized:!0,perMessageDeflate:{threshold:1024},transportOptions:{},closeOnBeforeunload:!1},$),this.opts.path=this.opts.path.replace(/\/$/,"")+(this.opts.addTrailingSlash?"/":""),typeof this.opts.query==="string")this.opts.query=g1(this.opts.query);if(K1){if(this.opts.closeOnBeforeunload)this._beforeunloadEventListener=()=>{if(this.transport)this.transport.removeAllListeners(),this.transport.close()},addEventListener("beforeunload",this._beforeunloadEventListener,!1);if(this.hostname!=="localhost")this._offlineEventListener=()=>{this._onClose("transport close",{description:"network connection lost"})},c.push(this._offlineEventListener)}if(this.opts.withCredentials)this._cookieJar=E1();this._open()}createTransport(I){let $=Object.assign({},this.opts.query);if($.EIO=$1,$.transport=I,this.id)$.sid=this.id;let Q=Object.assign({},this.opts,{query:$,socket:this,hostname:this.hostname,secure:this.secure,port:this.port},this.opts.transportOptions[I]);return new this._transportsByName[I](Q)}_open(){if(this.transports.length===0){this.setTimeoutFn(()=>{this.emitReserved("error","No transports available")},0);return}let I=this.opts.rememberUpgrade&&A.priorWebsocketSuccess&&this.transports.indexOf("websocket")!==-1?"websocket":this.transports[0];this.readyState="opening";let $=this.createTransport(I);$.open(),this.setTransport($)}setTransport(I){if(this.transport)this.transport.removeAllListeners();this.transport=I,I.on("drain",this._onDrain.bind(this)).on("packet",this._onPacket.bind(this)).on("error",this._onError.bind(this)).on("close",($)=>this._onClose("transport close",$))}onOpen(){this.readyState="open",A.priorWebsocketSuccess=this.transport.name==="websocket",this.emitReserved("open"),this.flush()}_onPacket(I){if(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing")switch(this.emitReserved("packet",I),this.emitReserved("heartbeat"),I.type){case"open":this.onHandshake(JSON.parse(I.data));break;case"ping":this._sendPacket("pong"),this.emitReserved("ping"),this.emitReserved("pong"),this._resetPingTimeout();break;case"error":let $=new Error("server error");$.code=I.data,this._onError($);break;case"message":this.emitReserved("data",I.data),this.emitReserved("message",I.data);break}}onHandshake(I){if(this.emitReserved("handshake",I),this.id=I.sid,this.transport.query.sid=I.sid,this._pingInterval=I.pingInterval,this._pingTimeout=I.pingTimeout,this._maxPayload=I.maxPayload,this.onOpen(),this.readyState==="closed")return;this._resetPingTimeout()}_resetPingTimeout(){this.clearTimeoutFn(this._pingTimeoutTimer);let I=this._pingInterval+this._pingTimeout;if(this._pingTimeoutTime=Date.now()+I,this._pingTimeoutTimer=this.setTimeoutFn(()=>{this._onClose("ping timeout")},I),this.opts.autoUnref)this._pingTimeoutTimer.unref()}_onDrain(){if(this.writeBuffer.splice(0,this._prevBufferLen),this._prevBufferLen=0,this.writeBuffer.length===0)this.emitReserved("drain");else this.flush()}flush(){if(this.readyState!=="closed"&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length){let I=this._getWritablePackets();this.transport.send(I),this._prevBufferLen=I.length,this.emitReserved("flush")}}_getWritablePackets(){if(!(this._maxPayload&&this.transport.name==="polling"&&this.writeBuffer.length>1))return this.writeBuffer;let $=1;for(let Q=0;Q<this.writeBuffer.length;Q++){let Z=this.writeBuffer[Q].data;if(Z)$+=P1(Z);if(Q>0&&$>this._maxPayload)return this.writeBuffer.slice(0,Q);$+=2}return this.writeBuffer}_hasPingExpired(){if(!this._pingTimeoutTime)return!0;let I=Date.now()>this._pingTimeoutTime;if(I)this._pingTimeoutTime=0,D(()=>{this._onClose("ping timeout")},this.setTimeoutFn);return I}write(I,$,Q){return this._sendPacket("message",I,$,Q),this}send(I,$,Q){return this._sendPacket("message",I,$,Q),this}_sendPacket(I,$,Q,Z){if(typeof $==="function")Z=$,$=void 0;if(typeof Q==="function")Z=Q,Q=null;if(this.readyState==="closing"||this.readyState==="closed")return;Q=Q||{},Q.compress=Q.compress!==!1;let J={type:I,data:$,options:Q};if(this.emitReserved("packetCreate",J),this.writeBuffer.push(J),Z)this.once("flush",Z);this.flush()}close(){let I=()=>{this._onClose("forced close"),this.transport.close()},$=()=>{this.off("upgrade",$),this.off("upgradeError",$),I()},Q=()=>{this.once("upgrade",$),this.once("upgradeError",$)};if(this.readyState==="opening"||this.readyState==="open")if(this.readyState="closing",this.writeBuffer.length)this.once("drain",()=>{if(this.upgrading)Q();else I()});else if(this.upgrading)Q();else I();return this}_onError(I){if(A.priorWebsocketSuccess=!1,this.opts.tryAllTransports&&this.transports.length>1&&this.readyState==="opening")return this.transports.shift(),this._open();this.emitReserved("error",I),this._onClose("transport error",I)}_onClose(I,$){if(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing"){if(this.clearTimeoutFn(this._pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),K1){if(this._beforeunloadEventListener)removeEventListener("beforeunload",this._beforeunloadEventListener,!1);if(this._offlineEventListener){let Q=c.indexOf(this._offlineEventListener);if(Q!==-1)c.splice(Q,1)}}this.readyState="closed",this.id=null,this.emitReserved("close",I,$),this.writeBuffer=[],this._prevBufferLen=0}}}A.protocol=$1;class Y1 extends A{constructor(){super(...arguments);this._upgrades=[]}onOpen(){if(super.onOpen(),this.readyState==="open"&&this.opts.upgrade)for(let I=0;I<this._upgrades.length;I++)this._probe(this._upgrades[I])}_probe(I){let $=this.createTransport(I),Q=!1;A.priorWebsocketSuccess=!1;let Z=()=>{if(Q)return;$.send([{type:"ping",data:"probe"}]),$.once("packet",(F)=>{if(Q)return;if(F.type==="pong"&&F.data==="probe"){if(this.upgrading=!0,this.emitReserved("upgrading",$),!$)return;A.priorWebsocketSuccess=$.name==="websocket",this.transport.pause(()=>{if(Q)return;if(this.readyState==="closed")return;C(),this.setTransport($),$.send([{type:"upgrade"}]),this.emitReserved("upgrade",$),$=null,this.upgrading=!1,this.flush()})}else{let m=new Error("probe error");m.transport=$.name,this.emitReserved("upgradeError",m)}})};function J(){if(Q)return;Q=!0,C(),$.close(),$=null}let K=(F)=>{let m=new Error("probe error: "+F);m.transport=$.name,J(),this.emitReserved("upgradeError",m)};function Y(){K("transport closed")}function M(){K("socket closed")}function z(F){if($&&F.name!==$.name)J()}let C=()=>{$.removeListener("open",Z),$.removeListener("error",K),$.removeListener("close",Y),this.off("close",M),this.off("upgrading",z)};if($.once("open",Z),$.once("error",K),$.once("close",Y),this.once("close",M),this.once("upgrading",z),this._upgrades.indexOf("webtransport")!==-1&&I!=="webtransport")this.setTimeoutFn(()=>{if(!Q)$.open()},200);else $.open()}onHandshake(I){this._upgrades=this._filterUpgrades(I.upgrades),super.onHandshake(I)}_filterUpgrades(I){let $=[];for(let Q=0;Q<I.length;Q++)if(~this.transports.indexOf(I[Q]))$.push(I[Q]);return $}}class g extends Y1{constructor(I,$={}){let Q=typeof I==="object"?I:$;if(!Q.transports||Q.transports&&typeof Q.transports[0]==="string")Q.transports=(Q.transports||["polling","websocket","webtransport"]).map((Z)=>J1[Z]).filter((Z)=>!!Z);super(I,Q)}}var T0=g.protocol;function n1(I,$="",Q){let Z=I;if(Q=Q||typeof location!=="undefined"&&location,I==null)I=Q.protocol+"//"+Q.host;if(typeof I==="string"){if(I.charAt(0)==="/")if(I.charAt(1)==="/")I=Q.protocol+I;else I=Q.host+I;if(!/^(https?|wss?):\/\//.test(I))if(typeof Q!=="undefined")I=Q.protocol+"//"+I;else I="https://"+I;Z=_(I)}if(!Z.port){if(/^(http|ws)$/.test(Z.protocol))Z.port="80";else if(/^(http|ws)s$/.test(Z.protocol))Z.port="443"}Z.path=Z.path||"/";let K=Z.host.indexOf(":")!==-1?"["+Z.host+"]":Z.host;return Z.id=Z.protocol+"://"+K+":"+Z.port+$,Z.href=Z.protocol+"://"+K+(Q&&Q.port===Z.port?"":":"+Z.port),Z}var M1={};H1(M1,{protocol:()=>p1,PacketType:()=>O,Encoder:()=>r1,Decoder:()=>z1});var L4=typeof ArrayBuffer==="function",A4=(I)=>{return typeof ArrayBuffer.isView==="function"?ArrayBuffer.isView(I):I.buffer instanceof ArrayBuffer},i1=Object.prototype.toString,B4=typeof Blob==="function"||typeof Blob!=="undefined"&&i1.call(Blob)==="[object BlobConstructor]",N4=typeof File==="function"||typeof File!=="undefined"&&i1.call(File)==="[object FileConstructor]";function j(I){return L4&&(I instanceof ArrayBuffer||A4(I))||B4&&I instanceof Blob||N4&&I instanceof File}function T(I,$){if(!I||typeof I!=="object")return!1;if(Array.isArray(I)){for(let Q=0,Z=I.length;Q<Z;Q++)if(T(I[Q]))return!0;return!1}if(j(I))return!0;if(I.toJSON&&typeof I.toJSON==="function"&&arguments.length===1)return T(I.toJSON(),!0);for(let Q in I)if(Object.prototype.hasOwnProperty.call(I,Q)&&T(I[Q]))return!0;return!1}function d1(I){let $=[],Q=I.data,Z=I;return Z.data=O1(Q,$),Z.attachments=$.length,{packet:Z,buffers:$}}function O1(I,$){if(!I)return I;if(j(I)){let Q={_placeholder:!0,num:$.length};return $.push(I),Q}else if(Array.isArray(I)){let Q=new Array(I.length);for(let Z=0;Z<I.length;Z++)Q[Z]=O1(I[Z],$);return Q}else if(typeof I==="object"&&!(I instanceof Date)){let Q={};for(let Z in I)if(Object.prototype.hasOwnProperty.call(I,Z))Q[Z]=O1(I[Z],$);return Q}return I}function k1(I,$){return I.data=X1(I.data,$),delete I.attachments,I}function X1(I,$){if(!I)return I;if(I&&I._placeholder===!0)if(typeof I.num==="number"&&I.num>=0&&I.num<$.length)return $[I.num];else throw new Error("illegal attachments");else if(Array.isArray(I))for(let Q=0;Q<I.length;Q++)I[Q]=X1(I[Q],$);else if(typeof I==="object"){for(let Q in I)if(Object.prototype.hasOwnProperty.call(I,Q))I[Q]=X1(I[Q],$)}return I}var x4=["connect","connect_error","disconnect","disconnecting","newListener","removeListener"],p1=5,O;(function(I){I[I.CONNECT=0]="CONNECT",I[I.DISCONNECT=1]="DISCONNECT",I[I.EVENT=2]="EVENT",I[I.ACK=3]="ACK",I[I.CONNECT_ERROR=4]="CONNECT_ERROR",I[I.BINARY_EVENT=5]="BINARY_EVENT",I[I.BINARY_ACK=6]="BINARY_ACK"})(O||(O={}));class r1{constructor(I){this.replacer=I}encode(I){if(I.type===O.EVENT||I.type===O.ACK){if(T(I))return this.encodeAsBinary({type:I.type===O.EVENT?O.BINARY_EVENT:O.BINARY_ACK,nsp:I.nsp,data:I.data,id:I.id})}return[this.encodeAsString(I)]}encodeAsString(I){let $=""+I.type;if(I.type===O.BINARY_EVENT||I.type===O.BINARY_ACK)$+=I.attachments+"-";if(I.nsp&&I.nsp!=="/")$+=I.nsp+",";if(I.id!=null)$+=I.id;if(I.data!=null)$+=JSON.stringify(I.data,this.replacer);return $}encodeAsBinary(I){let $=d1(I),Q=this.encodeAsString($.packet),Z=$.buffers;return Z.unshift(Q),Z}}function c1(I){return Object.prototype.toString.call(I)==="[object Object]"}class z1 extends X{constructor(I){super();this.reviver=I}add(I){let $;if(typeof I==="string"){if(this.reconstructor)throw new Error("got plaintext data when reconstructing a packet");$=this.decodeString(I);let Q=$.type===O.BINARY_EVENT;if(Q||$.type===O.BINARY_ACK){if($.type=Q?O.EVENT:O.ACK,this.reconstructor=new o1($),$.attachments===0)super.emitReserved("decoded",$)}else super.emitReserved("decoded",$)}else if(j(I)||I.base64){if(!this.reconstructor)throw new Error("got binary data when not reconstructing a packet");else if($=this.reconstructor.takeBinaryData(I),$)this.reconstructor=null,super.emitReserved("decoded",$)}else throw new Error("Unknown type: "+I)}decodeString(I){let $=0,Q={type:Number(I.charAt(0))};if(O[Q.type]===void 0)throw new Error("unknown packet type "+Q.type);if(Q.type===O.BINARY_EVENT||Q.type===O.BINARY_ACK){let J=$+1;while(I.charAt(++$)!=="-"&&$!=I.length);let K=I.substring(J,$);if(K!=Number(K)||I.charAt($)!=="-")throw new Error("Illegal attachments");Q.attachments=Number(K)}if(I.charAt($+1)==="/"){let J=$+1;while(++$){if(I.charAt($)===",")break;if($===I.length)break}Q.nsp=I.substring(J,$)}else Q.nsp="/";let Z=I.charAt($+1);if(Z!==""&&Number(Z)==Z){let J=$+1;while(++$){let K=I.charAt($);if(K==null||Number(K)!=K){--$;break}if($===I.length)break}Q.id=Number(I.substring(J,$+1))}if(I.charAt(++$)){let J=this.tryParse(I.substr($));if(z1.isPayloadValid(Q.type,J))Q.data=J;else throw new Error("invalid payload")}return Q}tryParse(I){try{return JSON.parse(I,this.reviver)}catch($){return!1}}static isPayloadValid(I,$){switch(I){case O.CONNECT:return c1($);case O.DISCONNECT:return $===void 0;case O.CONNECT_ERROR:return typeof $==="string"||c1($);case O.EVENT:case O.BINARY_EVENT:return Array.isArray($)&&(typeof $[0]==="number"||typeof $[0]==="string"&&x4.indexOf($[0])===-1);case O.ACK:case O.BINARY_ACK:return Array.isArray($)}}destroy(){if(this.reconstructor)this.reconstructor.finishedReconstruction(),this.reconstructor=null}}class o1{constructor(I){this.packet=I,this.buffers=[],this.reconPack=I}takeBinaryData(I){if(this.buffers.push(I),this.buffers.length===this.reconPack.attachments){let $=k1(this.reconPack,this.buffers);return this.finishedReconstruction(),$}return null}finishedReconstruction(){this.reconPack=null,this.buffers=[]}}function V(I,$,Q){return I.on($,Q),function Z(){I.off($,Q)}}var q4=Object.freeze({connect:1,connect_error:1,disconnect:1,disconnecting:1,newListener:1,removeListener:1});class f extends X{constructor(I,$,Q){super();if(this.connected=!1,this.recovered=!1,this.receiveBuffer=[],this.sendBuffer=[],this._queue=[],this._queueSeq=0,this.ids=0,this.acks={},this.flags={},this.io=I,this.nsp=$,Q&&Q.auth)this.auth=Q.auth;if(this._opts=Object.assign({},Q),this.io._autoConnect)this.open()}get disconnected(){return!this.connected}subEvents(){if(this.subs)return;let I=this.io;this.subs=[V(I,"open",this.onopen.bind(this)),V(I,"packet",this.onpacket.bind(this)),V(I,"error",this.onerror.bind(this)),V(I,"close",this.onclose.bind(this))]}get active(){return!!this.subs}connect(){if(this.connected)return this;if(this.subEvents(),!this.io._reconnecting)this.io.open();if(this.io._readyState==="open")this.onopen();return this}open(){return this.connect()}send(...I){return I.unshift("message"),this.emit.apply(this,I),this}emit(I,...$){var Q,Z,J;if(q4.hasOwnProperty(I))throw new Error('"'+I.toString()+'" is a reserved event name');if($.unshift(I),this._opts.retries&&!this.flags.fromQueue&&!this.flags.volatile)return this._addToQueue($),this;let K={type:O.EVENT,data:$};if(K.options={},K.options.compress=this.flags.compress!==!1,typeof $[$.length-1]==="function"){let C=this.ids++,F=$.pop();this._registerAckCallback(C,F),K.id=C}let Y=(Z=(Q=this.io.engine)===null||Q===void 0?void 0:Q.transport)===null||Z===void 0?void 0:Z.writable,M=this.connected&&!((J=this.io.engine)===null||J===void 0?void 0:J._hasPingExpired());if(this.flags.volatile&&!Y);else if(M)this.notifyOutgoingListeners(K),this.packet(K);else this.sendBuffer.push(K);return this.flags={},this}_registerAckCallback(I,$){var Q;let Z=(Q=this.flags.timeout)!==null&&Q!==void 0?Q:this._opts.ackTimeout;if(Z===void 0){this.acks[I]=$;return}let J=this.io.setTimeoutFn(()=>{delete this.acks[I];for(let Y=0;Y<this.sendBuffer.length;Y++)if(this.sendBuffer[Y].id===I)this.sendBuffer.splice(Y,1);$.call(this,new Error("operation has timed out"))},Z),K=(...Y)=>{this.io.clearTimeoutFn(J),$.apply(this,Y)};K.withError=!0,this.acks[I]=K}emitWithAck(I,...$){return new Promise((Q,Z)=>{let J=(K,Y)=>{return K?Z(K):Q(Y)};J.withError=!0,$.push(J),this.emit(I,...$)})}_addToQueue(I){let $;if(typeof I[I.length-1]==="function")$=I.pop();let Q={id:this._queueSeq++,tryCount:0,pending:!1,args:I,flags:Object.assign({fromQueue:!0},this.flags)};I.push((Z,...J)=>{if(Q!==this._queue[0])return;if(Z!==null){if(Q.tryCount>this._opts.retries){if(this._queue.shift(),$)$(Z)}}else if(this._queue.shift(),$)$(null,...J);return Q.pending=!1,this._drainQueue()}),this._queue.push(Q),this._drainQueue()}_drainQueue(I=!1){if(!this.connected||this._queue.length===0)return;let $=this._queue[0];if($.pending&&!I)return;$.pending=!0,$.tryCount++,this.flags=$.flags,this.emit.apply(this,$.args)}packet(I){I.nsp=this.nsp,this.io._packet(I)}onopen(){if(typeof this.auth=="function")this.auth((I)=>{this._sendConnectPacket(I)});else this._sendConnectPacket(this.auth)}_sendConnectPacket(I){this.packet({type:O.CONNECT,data:this._pid?Object.assign({pid:this._pid,offset:this._lastOffset},I):I})}onerror(I){if(!this.connected)this.emitReserved("connect_error",I)}onclose(I,$){this.connected=!1,delete this.id,this.emitReserved("disconnect",I,$),this._clearAcks()}_clearAcks(){Object.keys(this.acks).forEach((I)=>{if(!this.sendBuffer.some((Q)=>String(Q.id)===I)){let Q=this.acks[I];if(delete this.acks[I],Q.withError)Q.call(this,new Error("socket has been disconnected"))}})}onpacket(I){if(I.nsp!==this.nsp)return;switch(I.type){case O.CONNECT:if(I.data&&I.data.sid)this.onconnect(I.data.sid,I.data.pid);else this.emitReserved("connect_error",new Error("It seems you are trying to reach a Socket.IO server in v2.x with a v3.x client, but they are not compatible (more information here: https://socket.io/docs/v3/migrating-from-2-x-to-3-0/)"));break;case O.EVENT:case O.BINARY_EVENT:this.onevent(I);break;case O.ACK:case O.BINARY_ACK:this.onack(I);break;case O.DISCONNECT:this.ondisconnect();break;case O.CONNECT_ERROR:this.destroy();let Q=new Error(I.data.message);Q.data=I.data.data,this.emitReserved("connect_error",Q);break}}onevent(I){let $=I.data||[];if(I.id!=null)$.push(this.ack(I.id));if(this.connected)this.emitEvent($);else this.receiveBuffer.push(Object.freeze($))}emitEvent(I){if(this._anyListeners&&this._anyListeners.length){let $=this._anyListeners.slice();for(let Q of $)Q.apply(this,I)}if(super.emit.apply(this,I),this._pid&&I.length&&typeof I[I.length-1]==="string")this._lastOffset=I[I.length-1]}ack(I){let $=this,Q=!1;return function(...Z){if(Q)return;Q=!0,$.packet({type:O.ACK,id:I,data:Z})}}onack(I){let $=this.acks[I.id];if(typeof $!=="function")return;if(delete this.acks[I.id],$.withError)I.data.unshift(null);$.apply(this,I.data)}onconnect(I,$){this.id=I,this.recovered=$&&this._pid===$,this._pid=$,this.connected=!0,this.emitBuffered(),this.emitReserved("connect"),this._drainQueue(!0)}emitBuffered(){this.receiveBuffer.forEach((I)=>this.emitEvent(I)),this.receiveBuffer=[],this.sendBuffer.forEach((I)=>{this.notifyOutgoingListeners(I),this.packet(I)}),this.sendBuffer=[]}ondisconnect(){this.destroy(),this.onclose("io server disconnect")}destroy(){if(this.subs)this.subs.forEach((I)=>I()),this.subs=void 0;this.io._destroy(this)}disconnect(){if(this.connected)this.packet({type:O.DISCONNECT});if(this.destroy(),this.connected)this.onclose("io client disconnect");return this}close(){return this.disconnect()}compress(I){return this.flags.compress=I,this}get volatile(){return this.flags.volatile=!0,this}timeout(I){return this.flags.timeout=I,this}onAny(I){return this._anyListeners=this._anyListeners||[],this._anyListeners.push(I),this}prependAny(I){return this._anyListeners=this._anyListeners||[],this._anyListeners.unshift(I),this}offAny(I){if(!this._anyListeners)return this;if(I){let $=this._anyListeners;for(let Q=0;Q<$.length;Q++)if(I===$[Q])return $.splice(Q,1),this}else this._anyListeners=[];return this}listenersAny(){return this._anyListeners||[]}onAnyOutgoing(I){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.push(I),this}prependAnyOutgoing(I){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.unshift(I),this}offAnyOutgoing(I){if(!this._anyOutgoingListeners)return this;if(I){let $=this._anyOutgoingListeners;for(let Q=0;Q<$.length;Q++)if(I===$[Q])return $.splice(Q,1),this}else this._anyOutgoingListeners=[];return this}listenersAnyOutgoing(){return this._anyOutgoingListeners||[]}notifyOutgoingListeners(I){if(this._anyOutgoingListeners&&this._anyOutgoingListeners.length){let $=this._anyOutgoingListeners.slice();for(let Q of $)Q.apply(this,I.data)}}}function q(I){I=I||{},this.ms=I.min||100,this.max=I.max||1e4,this.factor=I.factor||2,this.jitter=I.jitter>0&&I.jitter<=1?I.jitter:0,this.attempts=0}q.prototype.duration=function(){var I=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var $=Math.random(),Q=Math.floor($*this.jitter*I);I=(Math.floor($*10)&1)==0?I-Q:I+Q}return Math.min(I,this.max)|0};q.prototype.reset=function(){this.attempts=0};q.prototype.setMin=function(I){this.ms=I};q.prototype.setMax=function(I){this.max=I};q.prototype.setJitter=function(I){this.jitter=I};class y extends X{constructor(I,$){var Q;super();if(this.nsps={},this.subs=[],I&&typeof I==="object")$=I,I=void 0;$=$||{},$.path=$.path||"/socket.io",this.opts=$,L(this,$),this.reconnection($.reconnection!==!1),this.reconnectionAttempts($.reconnectionAttempts||1/0),this.reconnectionDelay($.reconnectionDelay||1000),this.reconnectionDelayMax($.reconnectionDelayMax||5000),this.randomizationFactor((Q=$.randomizationFactor)!==null&&Q!==void 0?Q:0.5),this.backoff=new q({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout($.timeout==null?20000:$.timeout),this._readyState="closed",this.uri=I;let Z=$.parser||M1;if(this.encoder=new Z.Encoder,this.decoder=new Z.Decoder,this._autoConnect=$.autoConnect!==!1,this._autoConnect)this.open()}reconnection(I){if(!arguments.length)return this._reconnection;if(this._reconnection=!!I,!I)this.skipReconnect=!0;return this}reconnectionAttempts(I){if(I===void 0)return this._reconnectionAttempts;return this._reconnectionAttempts=I,this}reconnectionDelay(I){var $;if(I===void 0)return this._reconnectionDelay;return this._reconnectionDelay=I,($=this.backoff)===null||$===void 0||$.setMin(I),this}randomizationFactor(I){var $;if(I===void 0)return this._randomizationFactor;return this._randomizationFactor=I,($=this.backoff)===null||$===void 0||$.setJitter(I),this}reconnectionDelayMax(I){var $;if(I===void 0)return this._reconnectionDelayMax;return this._reconnectionDelayMax=I,($=this.backoff)===null||$===void 0||$.setMax(I),this}timeout(I){if(!arguments.length)return this._timeout;return this._timeout=I,this}maybeReconnectOnOpen(){if(!this._reconnecting&&this._reconnection&&this.backoff.attempts===0)this.reconnect()}open(I){if(~this._readyState.indexOf("open"))return this;this.engine=new g(this.uri,this.opts);let $=this.engine,Q=this;this._readyState="opening",this.skipReconnect=!1;let Z=V($,"open",function(){Q.onopen(),I&&I()}),J=(Y)=>{if(this.cleanup(),this._readyState="closed",this.emitReserved("error",Y),I)I(Y);else this.maybeReconnectOnOpen()},K=V($,"error",J);if(this._timeout!==!1){let Y=this._timeout,M=this.setTimeoutFn(()=>{Z(),J(new Error("timeout")),$.close()},Y);if(this.opts.autoUnref)M.unref();this.subs.push(()=>{this.clearTimeoutFn(M)})}return this.subs.push(Z),this.subs.push(K),this}connect(I){return this.open(I)}onopen(){this.cleanup(),this._readyState="open",this.emitReserved("open");let I=this.engine;this.subs.push(V(I,"ping",this.onping.bind(this)),V(I,"data",this.ondata.bind(this)),V(I,"error",this.onerror.bind(this)),V(I,"close",this.onclose.bind(this)),V(this.decoder,"decoded",this.ondecoded.bind(this)))}onping(){this.emitReserved("ping")}ondata(I){try{this.decoder.add(I)}catch($){this.onclose("parse error",$)}}ondecoded(I){D(()=>{this.emitReserved("packet",I)},this.setTimeoutFn)}onerror(I){this.emitReserved("error",I)}socket(I,$){let Q=this.nsps[I];if(!Q)Q=new f(this,I,$),this.nsps[I]=Q;else if(this._autoConnect&&!Q.active)Q.connect();return Q}_destroy(I){let $=Object.keys(this.nsps);for(let Q of $)if(this.nsps[Q].active)return;this._close()}_packet(I){let $=this.encoder.encode(I);for(let Q=0;Q<$.length;Q++)this.engine.write($[Q],I.options)}cleanup(){this.subs.forEach((I)=>I()),this.subs.length=0,this.decoder.destroy()}_close(){this.skipReconnect=!0,this._reconnecting=!1,this.onclose("forced close")}disconnect(){return this._close()}onclose(I,$){var Q;if(this.cleanup(),(Q=this.engine)===null||Q===void 0||Q.close(),this.backoff.reset(),this._readyState="closed",this.emitReserved("close",I,$),this._reconnection&&!this.skipReconnect)this.reconnect()}reconnect(){if(this._reconnecting||this.skipReconnect)return this;let I=this;if(this.backoff.attempts>=this._reconnectionAttempts)this.backoff.reset(),this.emitReserved("reconnect_failed"),this._reconnecting=!1;else{let $=this.backoff.duration();this._reconnecting=!0;let Q=this.setTimeoutFn(()=>{if(I.skipReconnect)return;if(this.emitReserved("reconnect_attempt",I.backoff.attempts),I.skipReconnect)return;I.open((Z)=>{if(Z)I._reconnecting=!1,I.reconnect(),this.emitReserved("reconnect_error",Z);else I.onreconnect()})},$);if(this.opts.autoUnref)Q.unref();this.subs.push(()=>{this.clearTimeoutFn(Q)})}}onreconnect(){let I=this.backoff.attempts;this._reconnecting=!1,this.backoff.reset(),this.emitReserved("reconnect",I)}}var l={};function u(I,$){if(typeof I==="object")$=I,I=void 0;$=$||{};let Q=n1(I,$.path||"/socket.io"),Z=Q.source,J=Q.id,K=Q.path,Y=l[J]&&K in l[J].nsps,M=$.forceNew||$["force new connection"]||$.multiplex===!1||Y,z;if(M)z=new y(Z,$);else{if(!l[J])l[J]=new y(Z,$);z=l[J]}if(Q.query&&!$.query)$.query=Q.queryKey;return z.socket(Q.path,$)}Object.assign(u,{Manager:y,Socket:f,io:u,connect:u});var p,_4=new Uint8Array(16);function G1(){if(!p){if(p=typeof crypto!=="undefined"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!p)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported")}return p(_4)}var G=[];for(let I=0;I<256;++I)G.push((I+256).toString(16).slice(1));function s1(I,$=0){return G[I[$+0]]+G[I[$+1]]+G[I[$+2]]+G[I[$+3]]+"-"+G[I[$+4]]+G[I[$+5]]+"-"+G[I[$+6]]+G[I[$+7]]+"-"+G[I[$+8]]+G[I[$+9]]+"-"+G[I[$+10]]+G[I[$+11]]+G[I[$+12]]+G[I[$+13]]+G[I[$+14]]+G[I[$+15]]}var m4=typeof crypto!=="undefined"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),F1={randomUUID:m4};function R4(I,$,Q){if(F1.randomUUID&&!$&&!I)return F1.randomUUID();I=I||{};let Z=I.random||(I.rng||G1)();if(Z[6]=Z[6]&15|64,Z[8]=Z[8]&63|128,$){Q=Q||0;for(let J=0;J<16;++J)$[Q+J]=Z[J];return $}return s1(Z)}var w=R4;var Z4={};H1(Z4,{IndexedDB:()=>o,ImplementableStorageAdapter:()=>I4,ImplementableNetworkAdapter:()=>$4,BrowserNetwork:()=>Q4});function r(I){return new Promise(($,Q)=>{I.oncomplete=I.onsuccess=()=>$(I.result),I.onabort=I.onerror=()=>Q(I.error)})}function V1(I,$){let Q,Z=()=>{if(Q)return Q;let J=indexedDB.open(I);return J.onupgradeneeded=()=>J.result.createObjectStore($),Q=r(J),Q.then((K)=>{K.onclose=()=>Q=void 0},()=>{}),Q};return(J,K)=>Z().then((Y)=>K(Y.transaction($,J).objectStore($)))}var U1;function C1(){if(!U1)U1=V1("keyval-store","keyval");return U1}function t1(I,$=C1()){return $("readonly",(Q)=>r(Q.get(I)))}function a1(I,$,Q=C1()){return Q("readwrite",(Z)=>{return Z.put($,I),r(Z.transaction)})}function e1(I,$=C1()){return $("readwrite",(Q)=>{return Q.delete(I),r(Q.transaction)})}class I4{async set(I,$){}async get(I,$){}async remove(I,$){}}class o{store;constructor(I){this.store=V1("cloudstore-cache",I)}async get(I){return await t1(I)}async remove(I){return await e1(I)}async set(I,$){return await a1(I,$)}}class $4{constructor(){}onNetworkUpdate(I){}}class Q4{state={online:window.navigator.onLine};constructor(){}onNetworkUpdate(I){window.addEventListener("offline",()=>{this.state.online=!1,I("DISCONNECTED")}),window.addEventListener("online",()=>{this.state.online=!0,I("CONNECTED")}),I(window.navigator.onLine?"CONNECTED":"DISCONNECTED")}}class s{query={id:void 0,filters:[],limit:null};constructor(I){this.query.id=I}orderBy(I,$){return this.query.orderBy={field:I,direction:$},this}limit(I){return this.query.limit=I,this}where(I,$,Q){return this.query.filters.push({field:I,op:$,value:Q}),this}get _query(){return this.query}}class t{internal={subscriptions:[]};constructor(I){let $={id:w(),config:I};this.internal.subscriptions.push($),I.socket.on("watchable-change-"+$.id,(Q)=>{I.onUpdate(Q)}),I.socket.emit("watch",{stream:{id:$.id},watchable:{type:"kn.cloudstore.collection",database:{name:I.database.name??"default"},collection:{name:I.collection.name},query:{structured:{from:{collection:I.collection.name},where:I.filters,orderBy:{field:I.orderBy.field,direction:I.orderBy.direction??"ASCENDING"},limit:I.limit}}}})}}class a{internals;constructor(I){this.internals=I}watch(I,$){if(!this.internals.collection.exists)throw new Error("Collection doesn't exist");return new t({filters:I._query.filters,socket:this.internals.socket,limit:I._query.limit,orderBy:I._query.orderBy,database:{name:this.internals.database.name},collection:this.internals.collection,onUpdate:$})}remove(I){let $=w();return new Promise((Q,Z)=>{this.internals.socket.on("delete-cb-"+$,({status:J,...K})=>{J?Q(K):Z(K),this.internals.socket.removeListener("delete-cb-"+$)}),this.internals.socket.emit("delete",{type:"kn.cloudstore.document:array",database:{name:this.internals.database.name},collection:{name:this.internals.collection.name},ref:{id:$},query:{structured:{from:{collection:this.internals.collection.name},where:I._query.filters}}})})}update(I){let $=w();return new Promise((Q,Z)=>{this.internals.socket?.on("update-cb-"+$,({status:J,...K})=>{J?Q(K):Z(K),this.internals.socket?.removeListener("update-cb-"+$)}),this.internals.socket?.emit("update",{type:"kn.cloudstore.document",database:{name:this.internals.database.name},collection:{name:this.internals.collection.name},ref:{id:$},options:{},insertions:[{data:I}]})})}insert(I){let $=w();return new Promise((Q,Z)=>{this.internals.socket?.on("insert-cb-"+$,({status:J,...K})=>{J?Q(K):Z(K),this.internals.socket?.removeListener("insert-cb-"+$)}),this.internals.socket?.emit("insert",{type:"kn.cloudstore.document:array",database:{name:this.internals.database.name},collection:{name:this.internals.collection.name},ref:{id:$},options:{},insertions:[{data:I}]})})}}var v4={};class J4{static utils={};internals={socket:void 0,constructorConfig:void 0,connection:{connected:!1,remote:{config:void 0}},contexts:{},cache:{active:"IF_NO_NETWORK",storage:{adapter:new o("_kn.cloudstore.cache.temp.collection")}}};constructor(I){this.internals.socket=u(I.server.uri,{extraHeaders:{authorization:`Bearer ${I.server.access.key}`},query:{id:I.server.access.key}}),this.internals.constructorConfig=I,this.internals.cache.storage.adapter=I.cache.storage.adapter}connect(){if(!this.internals.socket)throw new Error("Socket Doesn't Exist");this.internals.socket.emit("config",{database:this.internals.constructorConfig.database}),this.internals.socket.on("config-cb",(I)=>{this.internals.connection.connected=!0,this.internals.connection.remote.config=I})}QueryWithCallback(I,$,Q,{cleanup:Z}={cleanup:!0}){return new Promise((J,K)=>{this.internals.socket?.on(Q,async(Y)=>{if(!Y?.error)J(Y);else K(Y);if(Z)this.internals.socket?.removeListener(Q)}),this.internals.socket?.emit(I,$)})}get query(){let I=w(),$=new s(I);return this.internals.contexts[I]=$,$}collection(I){let $=w();if(this.internals.socket?.on("collection-cb-"+$,(Q)=>{if(!Q.exists)throw new Error("Collection: "+Q.name+" does not exist?")}),this.internals.socket?.emit("collection",{name:I,ref:{id:$}}),!this.internals.socket||!this.internals.constructorConfig?.database)return;return new a({database:this.internals.constructorConfig.database,collection:{exists:!0,name:I},socket:this.internals.socket})}get info(){return this.internals}}export{J4 as default,v4 as Types,Z4 as Adapters};
